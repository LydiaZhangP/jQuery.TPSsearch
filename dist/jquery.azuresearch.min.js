!function(e){var a={azureSearch:{url:"",key:""},googleGeocodeApi:{key:null,url:"https://maps.googleapis.com/maps/api/geocode/json",language:"en"},geoSearch:{lat:null,lng:null,fieldName:"_distance",azureFieldName:null,unit:"K",maxDistance:null},searchParams:{search:"*",facets:[],count:!0,top:null,skip:0,filter:null,orderby:null},dates:{hasDates:!1,fields:{zone:"EST",from:{indexField:null,fieldId:null},to:{indexField:null,fieldId:null}}},facets:{facet:'<a href="#"/>',facetClass:"facet",titleWrapper:"<h2/>",title:'<a href="#"/>',titleClass:"",titleOnClick:function(){},titleWrapperClass:"facet-title",container:"#facets",wrapperContainer:"<ul/>",wrapperContainerClass:"facet-list",wrapper:"<li/>",wrapperClass:"facet-item",showCount:!0,countWrapper:null,countWrapperClass:null,facetOnClick:function(r){r.preventDefault();var s=e(this).data("azuresearchFacetName")+"||"+e(this).data("azuresearchFacetValue");"SELECT"==r.target.nodeName&&(s=e(this).data("azuresearchFacetName")+"||"+e(this).val());if(-1!=a.facetsSelected.indexOf(s))return;a.searchParams.skip=0,t.currentPage=1,a.facetsSelected.push(s),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),a.facets.onFacetSelect.call(a.facetsSelected.slice(0)),l()},searchMode:"and",onFacetSelect:function(){var r=a.results,s=a.facetsApplied;if(!s.container)return;var n=this.pop(),c=e(s.container),o=n.split("||");if(-1!=s.ignoreFacets.indexOf(o[0]))return;r.labels.activeFacets&&!t.hasActiveFacets&&c.prepend(e("<span/>").addClass("selected-facet-label").text(r.labels.activeFacets));var i=null,d=null;c.find('.selected-facets-group[data-az-field="'+o[0]+'"]').length>0&&s.groupFacetsByType?i=c.find('.selected-facets-group[data-az-field="'+o[0]+'"]'):s.groupFacetsByType&&(i=e("<div/>").addClass("selected-facets-group").attr("data-az-field",o[0]).appendTo(c),d=o[0],e.each(a.facetsDictionary,function(e,a){if(a.fieldName==o[0])return d=a.label,!1}),e("<span/>").addClass("selected-facets-group-title").text(d).appendTo(i));let p=o[1];e.each(a.facetsDictionary,function(e,a){if(a.fieldName==o[0])return a.translate&&(p=a.translate.call(this,o[0],o[1])),!1});var u=e("<a/>").text(p).attr({href:"#"}).attr(s.extraAttributes).data("value",n).addClass(s.class).on("click",function(r){r.preventDefault(),a.facetsSelected.splice(a.facetsSelected.indexOf(e(this).data("value")),1),a.searchParams.skip=0,t.currentPage=1,a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),a.facetsApplied.groupFacetsByType&&e(this).parent('.selected-facets-group[data-az-field="'+o[0]+'"]').children(".selected-facet").length<=1?e(this).parent('.selected-facets-group[data-az-field="'+o[0]+'"]').remove():e(this).remove(),c.children().not(".clear-all-facets, .selected-facet-label").length>0||(t.hasActiveFacets=!1,t.clearAllAdded=!1,c.empty().hide()),l()});s.groupFacetsByType?u.appendTo(i):t.clearAllAdded?u.insertBefore(".clear-all-facets"):u.appendTo(c);s.clearAll.enabled&&!t.clearAllAdded&&(e("<a/>").text(s.clearAll.label).attr({href:"#"}).attr(s.extraAttributes).addClass("clear-all-facets").addClass(s.clearAll.className).on("click",function(e){e.preventDefault(),t.clearAllAdded=!1,t.hasActiveFacets=!1,c.empty().hide(),a.facetsSelected=[],a.searchParams.skip=0,t.currentPage=1,a.facetsApplied.onChange.call(a.facetsSelected),l()}).appendTo(c),t.clearAllAdded=!0);t.hasActiveFacets=!0,c.show()},groupWrapper:"<div/>",groupWrapperClass:"group",emptyFacetText:"(none)"},facetsApplied:{container:null,class:"selected-facet",extraAttributes:{},ignoreFacets:[],groupFacetsByType:!1,updateHistory:!1,clearAll:{enabled:!0,label:"Clear all",className:""},onChange:function(){}},facetsDictionary:null,facetsSelected:[],results:{container:"#results",template:null,noResultsClasses:"",onCreate:function(){},loaderContainer:null,pager:{container:null,loadMore:!0,appendPager:!1,pageSize:50,pagerRangeIncrement:5,enders:!0,updateHistory:!1,labels:{prev:"Previous",next:"Next",first:"First",last:"Last",load:"load more",ada:{current:"You are on page",item:"Go to page",prev:"Go to the previous page of results",next:"Go to the next page of results",first:"Go to the first page of results",last:"Go to the last page of results",load:"Load more results"}},classes:{prev:"",next:"",last:"",results:"",load:""},onRender:function(){},onPageChange:function(){}},labels:{activeFacets:"Filters",noResults:"Sorry there are no results for your query",haveResults:"Results Found",haveQueryBefore:"Your search for",haveQueryAfter:"returned {0} results"}},urlParameters:{address:"a",latitude:"l",longitude:"ln",latlong:null,search:"q",facets:"fc",page:"p"},orderbyOptions:{orderbySelector:null,orderbyEvent:"click",onOrderbyChange:function(t){let r=e(this).data("searchField"),s=e(this).data("searchDir");"SELECT"==e(this)[0].nodeName&&(r=e(this).find(":selected").data("searchField"),s=e(this).find(":selected").data("searchDir"));a.searchParams.orderby=r+" "+s,l()}},onResults:function(){(function(t){var r=a.facets,s=e(r.container);if(!s||!t["@search.facets"])return;s.html(""),e(Object.keys(a.facetsDictionary)).each(function(n,l){var c=a.facetsDictionary[l].fieldName;if(t["@search.facets"][c]){var o=l;o="object"==typeof a.facetsDictionary[l]&&a.facetsDictionary[l].label?a.facetsDictionary[l].label:c;var i=e(r.title).addClass(r.titleClass).text(o);r.titleWrapper&&(i=e(r.titleWrapper).addClass(r.titleWrapperClass).append(i)),s.append(i),i.on("click",r.titleOnClick);var d=e(r.wrapperContainer).addClass(r.wrapperContainerClass);s.append(d),"object"==typeof a.facetsDictionary[l]&&a.facetsDictionary[l].dropdown?function(t,r,s,n,l){var c=a.facets,o=e(c.container),i=e("<select />").data("azuresearchFacetName",n).on("change",c.facetOnClick).append(e("<option />").text("Select"));t.append(i);var d=0;if(e(s["@search.facets"][n]).each(function(t,r){let s=r.value;l.translate&&(s=l.translate.call(this,n,r.value));var o=e("<option />").text(s).attr("value",r.value);c.showCount&&o.text(o.text()+" ("+r.count+")"),-1!=a.facetsSelected.indexOf(n+"||"+r.value)&&o.attr("selected","selected"),i.append(o),d++}),c.groupWrapper&&d>0){var p=e(c.groupWrapper).addClass(c.groupWrapperClass);o.append(p),r.appendTo(p),t.appendTo(p)}0==d&&(r.remove(),t.remove())}(d,i,t,c,a.facetsDictionary[l]):function(t,r,s,n,l){var c=a.facets,o=e(c.container),i=0;if(e(s["@search.facets"][n]).each(function(r,s){let o=s.value;l.translate&&(o=l.translate.call(this,n,s.value));var d=e(c.facet).addClass(c.facetClass).html(o).on("click",c.facetOnClick).data("azuresearchFacetName",n).data("azuresearchFacetValue",s.value);c.showCount&&a.facets.countWrapper?e(a.facets.countWrapper).text("("+s.count+")").addClass(a.facets.countWrapperClass).appendTo(d):c.showCount&&d.append(" ("+s.count+")"),-1!=a.facetsSelected.indexOf(n+"||"+s.value)&&d.addClass("active-facet"),c.wrapper?e(c.wrapper).addClass(c.wrapperClass).append(d).appendTo(t):t.append(d),i++}),c.groupWrapper&&i>0){var d=e(c.groupWrapper).addClass(c.groupWrapperClass);o.append(d),r.appendTo(d),t.appendTo(d)}0==i&&(r.remove(),t.remove())}(d,i,t,c,a.facetsDictionary[l])}})})(this),function(r){var s=a.results,n=e(s.loaderContainer),l=e(s.container)?e(s.container):e(t.container);if(!l||!r.value)return;(function(r){var s=a.results,n=e(s.resultsMsgContainer);if(n){var l=e("<span/>").append(s.labels.haveResults+" "+r);t.queryText&&(l.empty(),l.append(s.labels.haveQueryBefore+" "),l.append(e("<span>").addClass("query-text").text(t.queryText)),l.append(" "+s.labels.haveQueryAfter.replace("{0}",r))),l.appendTo(n),n.fadeIn()}})(r["@odata.count"]),s.pager.loadMore&&0!=a.searchParams.skip||l.html("");0==r["@odata.count"]&&(n&&n.fadeOut(),e("<div/>").addClass("search-no-results "+s.noResultsClasses).text(s.labels.noResults).appendTo(l));e(r.value).each(function(r,c){if(s.template){var o=e(s.template);e(':not([data-search-field=""])',o).each(function(r,s){var n=e(s).data("searchField"),l="";if(n&&c[n])l=c[n];else if(n==a.geoSearch.fieldName&&t.isGeoSearch&&c[a.geoSearch.azureFieldName]){var o=c[a.geoSearch.azureFieldName];l=function(e,a,t,r,s){var n=Math.PI*e/180,l=Math.PI*t/180,c=a-r,o=Math.PI*c/180,i=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos(o);i>1&&(i=1);i=60*(i=180*(i=Math.acos(i))/Math.PI)*1.1515,"K"==s&&(i*=1.609344);"N"==s&&(i*=.8684);return i}(a.geoSearch.lat,a.geoSearch.lng,o.coordinates[1],o.coordinates[0],a.geoSearch.unit)}var i=e(s).data("searchValueFormat");i&&window[i]&&(l=window[i](l,c)),n&&(void 0!==e(s).data("searchValueFormatReplace")?e(s).replaceWith(l):e(s).html(l))}),l.append(o),n&&n.fadeOut(),s.onCreate.call(o)}else{var i=e("<ul/>"),d=e("<hr/>");e(Object.keys(c)).each(function(a,t){if(!c[t]||""==c[t])return!0;var r=e("<li/>").text(t+" : ").appendTo(i);e("<strong/>").text(c[t]).appendTo(r)}),i.appendTo(l),d.appendTo(l),s.onCreate.call(i)}}),l.fadeIn(),t.rendered=!0}(this),this["@odata.count"]>a.results.pager.pageSize&&function(r){var c=a.results.pager;if(c.appendPager){var o=e(c.container);o.empty(),t.pagerRendered||(t.pagerRange[0]=1,t.pagerRange[1]=c.pagerRangeIncrement,t.currentPage>=c.pagerRangeIncrement&&(t.pagerRange[0]=Math.floor(t.currentPage/c.pagerRangeIncrement)*c.pagerRangeIncrement,t.pagerRange[1]=(Math.floor(t.currentPage/c.pagerRangeIncrement)+1)*c.pagerRangeIncrement)),function(){var r=a.results.pager,c=e(r.container);if(!c)return;if(r.loadMore)c.append(s("load"));else{var o;r.enders&&c.append(s("first")),c.append(s("prev")),o=t.pagerRendered?e(".pager-nav-items").empty():e("<div/>").addClass("pager-nav-items");for(var i=t.pagerRange[0];i<=t.pagerRange[1]&&i<=t.totalPages;){var d=e('<a href="#">').data("targetPage",i);i===t.currentPage?(d=e("<span></span>")).attr("title",r.labels.ada.current+" "+i):d.attr("title",r.labels.ada.item+" "+i),d.text(i),o.append(d),i++}c?(c.append(o),c.append(s("next")),r.enders&&c.append(s("last"))):(c.append(s("next")),r.enders&&c.append(s("last")),e(t.container).after(c))}t.pagerRendered||(e(".pager-prev, .pager-next, .pager-load").on("click",function(r){var s;r.preventDefault(),e(this).data("disabled")||(s=e(this).hasClass("pager-prev"),a.results.pager,a.results.pager.pageSize&&t.currentPage&&t.rendered&&(t.rendered=!1,t.currentPage=s?t.currentPage-1:t.currentPage+1,a.searchParams.skip=(t.currentPage-1)*a.results.pager.pageSize,l()))}),e(".pager-last, .pager-first").on("click",function(a){a.preventDefault(),e(this).data("disabled")||n(e(this).data("targetPage"))}),e(".pager-nav-items a").on("click",function(a){a.preventDefault(),n(e(this).data("targetPage"))}))}(),o.fadeIn(),t.pagerRendered=!0}}();a.onLoad.call(this,t)},onLoad:function(){},debug:!1},t={container:null,totalPages:0,currentPage:1,pagerRange:[],pagerRendered:!1,waitingLatLong:!1,isGeoSearch:!1,totalResults:0,initialized:!1,rendered:!1,fromDate:null,toDate:null,clearAllAdded:!1,queryText:null,hasActiveFacets:!1};function r(e){c("Google Geocode return:"),c(e);"OK"==e.status&&e.results.length>0&&(a.geoSearch.lat=e.results[0].geometry.location.lat,a.geoSearch.lng=e.results[0].geometry.location.lng),t.waitingLatLong=!1,l()}function s(r){var s=a.results.pager,n=e("<a/>").text(s.labels[r]).addClass("pager-navs").addClass("pager-"+r).attr("href","#").attr("title",s.labels.ada[r]);return s.classes[r]&&n.addClass(s.classes[r]),"first"==r?n.data("targetPage",1):"last"==r&&n.data("targetPage",t.totalPages),t.pagerRendered&&(n=e(".pager-navs.pager-"+r)),"prev"==r||"first"==r?t.currentPage>1?n.data("disabled",!1).removeClass("disabled"):n.data("disabled",!0).addClass("disabled"):t.totalPages>t.currentPage?n.data("disabled",!1).removeClass("disabled"):n.data("disabled",!0).addClass("disabled"),n}function n(e){t.currentPage=e,a.searchParams.skip=(t.currentPage-1)*a.results.pager.pageSize,l()}function l(){if(a.results.pager.updateHistory&&function(){var e,r,s,n,l;e=window.location.pathname+window.location.search,s=a.urlParameters.page,r=e.indexOf(s)>-1?i(e,s):e;t.currentPage>1?(n=t.currentPage.toString(),l=r,l+=r.indexOf("?")>-1?"&":"?",l+=s+"="+n):l=r;window.history.replaceState({url:l},"page",l)}(),a.facetsApplied.updateHistory&&function(){var t,r,s,n,l;r=window.location.pathname+window.location.search,t=a.urlParameters.facets,s=r.indexOf(t)>-1?i(r,t):r;a.facetsSelected.length>0?(n="",e.each(a.facetsSelected,function(e,a){e>0&&(n+=";"),n+=encodeURIComponent(a.toString())}),l=s,l+=s.indexOf("?")>-1?"&":"?",l+=t+"="+n):l=s;window.history.replaceState({url:l},"",l)}(),t.isGeoSearch=!1,a.results.loaderContainer&&e(a.results.loaderContainer).fadeIn(),a.results.pager.container&&e(a.results.pager.container).empty().fadeOut(),a.results.resultsMsgContainer&&e(a.results.resultsMsgContainer).empty().fadeOut(),t.pagerRendered=!1,!t.waitingLatLong){if(a.geoSearch.lat&&a.geoSearch.lng&&(c("Geo searching..."),c(a.geoSearch.lat),c(a.geoSearch.lng),t.isGeoSearch=!0,!a.searchParams.orderby||0==a.searchParams.orderby.indexOf(a.geoSearch.fieldName))){var r="geo.distance("+a.geoSearch.azureFieldName;r+=", geography'POINT("+a.geoSearch.lng+" "+a.geoSearch.lat+")')",a.searchParams.orderby&&-1!=a.searchParams.orderby.indexOf(" desc")&&(r+=" desc"),a.searchParams.orderby=r}var s=null,n=a.searchParams.filter;if(a.searchParams.facets=[],a.facetsDictionary&&e(Object.keys(a.facetsDictionary)).each(function(e,t){var r=null;"object"==typeof a.facetsDictionary[t]&&a.facetsDictionary[t].params&&(r=a.facetsDictionary[t].fieldName+","),r+=a.facetsDictionary[t].params,a.searchParams.facets.push(r)}),a.facetsSelected.length>0){var l=[];a.facetsSelected.forEach(function(e,a){var t=e.split("||");l.push(t[0]+"/any(m: m eq '"+t[1].replace(/[']/gi,"''")+"')")}),s=l.join(" "+a.facets.searchMode+" "),n&&(s=a.searchParams.filter+" "+a.facets.searchMode+" "+s)}if(t.isGeoSearch&&a.geoSearch.maxDistance){c("Filter Geo searching by distance : "+a.geoSearch.maxDistance);var o="geo.distance("+a.geoSearch.azureFieldName+", geography'POINT("+a.geoSearch.lng+" "+a.geoSearch.lat+")') le "+a.geoSearch.maxDistance;s?s+=" "+a.facets.searchMode+" "+o:(s=o,n&&(s=a.searchParams.filter+" "+a.facets.searchMode+" "+s))}var d="";t.dateSearch&&(t.fromDate&&(d=a.dates.fields.from.indexField+" ge "+t.fromDate.toISOString()),t.toDate&&(t.fromDate&&(d+=" "+a.facets.searchMode+" "),d+=a.dates.fields.to.indexField+" le "+t.toDate.toISOString()),s?s+=" "+a.facets.searchMode+" "+d:s=d),s&&(a.searchParams.filter=s);var p={crossDomain:!0,url:a.azureSearch.url,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","api-key":a.azureSearch.key,"Cache-Control":"no-cache"},data:JSON.stringify(a.searchParams)};e.ajax(p).done(function(e){t.totalResults=a.searchParams.count&&e["@odata.count"]?e["@odata.count"]:-1,t.totalPages=Math.ceil(t.totalResults/a.results.pager.pageSize),a.onResults.call(e,t)}),a.searchParams.filter=n}}function c(e){a.debug&&window.console&&window.console.log&&window.console.log(e)}function o(e){if(!e)return null;var a,t,r=decodeURIComponent(window.location.search.substring(1)).split("&");for(t=0;t<r.length;t++)if((a=r[t].split("="))[0]===e)return void 0===a[1]||a[1];return null}function i(e,a,t){var r=e.indexOf("#"),s=-1===r?"":e.substr(r);e=-1===r?e:e.substr(0,r);var n=new RegExp("([?&])"+a+"=.*?(&|$)","i"),l=-1!==e.indexOf("?")?"&":"?";return t?e=e.match(n)?e.replace(n,"$1"+a+"="+t+"$2"):e+l+a+"="+t:("?"===(e=e.replace(new RegExp("([?&]?)"+a+"=[^&]*","i"),"")).slice(-1)&&(e=e.slice(0,-1)),-1===e.indexOf("?")&&(e=e.replace(/&/,"?"))),e+s}e.fn.azuresearch=function(s,n){switch(t.container=this,n||(n="search"),s&&(s.googleGeocodeApi&&(s.googleGeocodeApi=e.extend(a.googleGeocodeApi,s.googleGeocodeApi)),s.geoSearch&&(s.geoSearch=e.extend(a.geoSearch,s.geoSearch)),s.searchParams&&(s.searchParams=e.extend(a.searchParams,s.searchParams)),s.dates&&(s.dates=e.extend(!0,a.dates,s.dates)),s.facets&&(s.facets=e.extend(a.facets,s.facets)),s.facetsApplied&&(s.facetsApplied=e.extend(!0,a.facetsApplied,s.facetsApplied)),s.results&&(s.results=e.extend(!0,a.results,s.results)),s.urlParameters&&(s.urlParameters=e.extend(a.urlParameters,s.urlParameters)),s.orderbyOptions&&(s.orderbyOptions=e.extend(a.orderbyOptions,s.orderbyOptions)),(a=e.extend(a,s)).searchParams.top=a.results.pager.pageSize,function(){var s=a.urlParameters,n=o(s.address),l=o(s.latitude),c=o(s.longitude),i=o(s.latlong),d=o(s.search),p=o(s.facets),u=o(s.page);i&&-1!=i.indexOf(",")&&(l=i.split(",")[0],c=i.split(",")[1]);d&&(a.searchParams.search=d.replace(/[\"]{1}/gi,'\\"'),t.queryText=d);u&&a.results.pager.updateHistory&&(t.currentPage=Math.floor(parseFloat(u)),a.results.pager.loadMore?(a.searchParams.skip=0,a.searchParams.top=t.currentPage*a.results.pager.pageSize):a.searchParams.skip=(t.currentPage-1)*a.results.pager.pageSize);p&&(a.facetsSelected=p.split(";"));l&&c&&(a.geoSearch.lat=l,a.geoSearch.lng=c);if(n&&!l&&!c&&!i){var f=function(s){var n=a.googleGeocodeApi;if(!n.key)return;t.waitingLatLong=!0;var l=n.url;l+=-1!=l.indexOf("?")?"&":"?",l+="key="+n.key,l+="&address="+s,l+="&language="+n.language,e.getJSON(l,r)}(n);f&&(l=f[0],c=f[1])}}()),t.initialized||(e(a.facetsSelected).each(function(e,t){a.facets.onFacetSelect.call([t])}),a.orderbyOptions.orderbySelector&&e(document).on(a.orderbyOptions.orderbyEvent,a.orderbyOptions.orderbySelector,a.orderbyOptions.onOrderbyChange)),a.dates.hasDates&&function(){var r=a.dates.fields;if(!r.from.selector||!r.from.indexField)return;var s=r.from.selector;r.to.selector&&r.to.indexField&&r.from.selector?s+=", "+r.to.selector:r.to.selector&&r.to.indexField&&(s=r.to.selector);function n(e,s){if(t[s]=null,e&&s){var n="00:00";"toDate"==s&&(n="23:59"),e=r.zone?e+" "+n+" "+r.zone:e+n;var c=new Date(e);t[s]=c}t.fromDate||t.toDate?t.dateSearch=!0:t.dateSearch=!1,a.searchParams.skip=0,t.currentPage=1,l()}e(s).on("change",function(a){n(e(this).val(),e(this).data("dateDir"))}),e(s).on("keydown",function(a){13===a.which?(a.preventDefault(),n(e(this).val(),e(this).data("dateDir"))):8!=a.which&&46!=a.which||(a.preventDefault(),e(this).val(""),n(e(this).val(),e(this).data("dateDir")))})}(),n){case"search":l();break;case"resetFacets":a.facetsSelected=[],a.facets.onFacetSelect.call(a.facetsSelected),l()}return t.initialized=!0,this}}(jQuery);